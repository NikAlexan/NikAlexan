---
import MobileMenu from "./MobileMenu.astro";
import Header from "./Header.astro";
import Footer from "./Footer.astro";

const { caseStudy, site } = Astro.props;

const navItems = site.locale === "ru"
  ? [
      { label: "ОБЗОР", href: "#overview" },
      { label: "ЗАДАЧА", href: "#challenge" },
      { label: "СТЕК", href: "#stack" },
      { label: "ИТОГ", href: "#outcome" }
    ]
  : [
      { label: "OVERVIEW", href: "#overview" },
      { label: "CHALLENGE", href: "#challenge" },
      { label: "TECH_STACK", href: "#stack" },
      { label: "OUTCOME", href: "#outcome" }
    ];

const statusClassMap = {
  success: "text-terminal-success",
  warning: "text-terminal-warning",
  error: "text-terminal-error",
  info: "text-terminal-info"
};

const statusDotMap = {
  success: "bg-status-online",
  warning: "bg-[color-mix(in_srgb,var(--color-warning)_40%,transparent)]",
  error: "bg-[color-mix(in_srgb,var(--color-error)_40%,transparent)]",
  info: "bg-[color-mix(in_srgb,var(--color-info)_40%,transparent)]"
};

const menuItems = [
  { label: "Index", href: site.nav.homeHref },
  ...site.nav.links.map((link, index) => ({
    label: link.label,
    href: `${site.nav.homeHref}${link.href}`,
    active: index === 0
  }))
];

const ruHref = `/project/${caseStudy.slug}`;
const enHref = `/en/project/${caseStudy.slug}`;
---

<div class="fixed inset-0 z-0 bg-grid-pattern opacity-100 grid-bg pointer-events-none"></div>
<div class="fixed inset-0 pointer-events-none z-0">
  <div class="absolute top-8 left-8 w-6 h-6 border-l border-t border-[color-mix(in_srgb,var(--color-ochre)_40%,transparent)]"></div>
  <div class="absolute top-8 right-8 w-6 h-6 border-r border-t border-[color-mix(in_srgb,var(--color-ochre)_40%,transparent)]"></div>
  <div class="absolute bottom-8 left-8 w-6 h-6 border-l border-b border-[color-mix(in_srgb,var(--color-ochre)_40%,transparent)]"></div>
  <div class="absolute bottom-8 right-8 w-6 h-6 border-r border-b border-[color-mix(in_srgb,var(--color-ochre)_40%,transparent)]"></div>
  <div class="absolute top-0 left-12 w-[1px] h-full bg-[color-mix(in_srgb,var(--color-ochre)_5%,transparent)] hidden md:block"></div>
  <div class="absolute top-0 right-12 w-[1px] h-full bg-[color-mix(in_srgb,var(--color-ochre)_5%,transparent)] hidden md:block"></div>
</div>
<MobileMenu items={menuItems} locale={site.locale} ruHref={ruHref} enHref={enHref} />
<Header homeHref={site.nav.homeHref} links={site.nav.links} locale={site.locale} ruHref={ruHref} enHref={enHref} />
<div class="relative z-10 w-full max-w-[1800px] mx-auto min-h-screen flex flex-col md:flex-row">
  <aside class="hidden md:flex flex-col w-64 h-screen sticky top-0 pt-32 pb-12 pl-12 justify-between">
    <div class="space-y-8 border-l border-[color-mix(in_srgb,var(--color-bronze)_20%,transparent)] pl-6 relative" data-nav-rail>
      <div class="absolute -left-[1px] top-0 w-[1px] h-12 bg-bronze shadow-[0_0_10px_rgba(168,93,61,0.3)]" data-nav-indicator></div>
      <div>
        <div class="font-mono text-[9px] text-disabled tracking-widest uppercase mb-4">Navigation</div>
        <ul class="space-y-4 font-mono text-[11px]" data-nav-list>
          {navItems.map((item, index) => (
            <li>
              <a
                class={`nav-link block text-muted hover:text-bronze transition-colors group flex items-center gap-2 ${index === 0 ? "is-active text-bronze font-bold glowing-text" : ""}`}
                data-nav-link
                href={item.href}
              >
                <span class={`nav-bullet w-1 h-1 bg-[color-mix(in_srgb,var(--color-charcoal)_20%,transparent)] group-hover:bg-bronze transition-colors ${index === 0 ? "is-active bg-bronze shadow-[0_0_5px_rgba(168,93,61,0.5)]" : ""}`} data-nav-bullet></span>
                {String(index).padStart(2, "0")}_{item.label}
              </a>
            </li>
          ))}
        </ul>
      </div>
    </div>
    <div class="font-mono text-[9px] text-disabled pl-6 border-l border-[color-mix(in_srgb,var(--color-bronze)_20%,transparent)]">
      <div class="mb-1 uppercase tracking-tighter">SYSTEM_STATUS</div>
      <div class="text-bronze flex items-center gap-2">
        <span class="w-1.5 h-1.5 rounded-full bg-bronze animate-pulse"></span>
        ONLINE
      </div>
    </div>
  </aside>
  <main id="main-content" class="flex-1 pt-32 px-6 md:px-16 pb-32 max-w-6xl mx-auto w-full">
    <section class="mb-32 relative text-center md:text-left" id="overview">
      <div class="hidden md:block absolute -top-10 left-0 w-8 h-[1px] bg-[color-mix(in_srgb,var(--color-bronze)_30%,transparent)]"></div>
      <div class="hidden md:block absolute -top-10 left-0 h-4 w-[1px] bg-[color-mix(in_srgb,var(--color-bronze)_30%,transparent)]"></div>
      <div class="inline-flex items-center gap-3 px-3 py-1 mb-8 border border-[color-mix(in_srgb,var(--color-bronze)_30%,transparent)] bg-[color-mix(in_srgb,var(--color-bronze)_5%,transparent)] text-bronze font-mono text-[10px] tracking-[0.2em] uppercase backdrop-blur-sm">
        <span class="w-1.5 h-1.5 bg-bronze rounded-sm"></span>
        {caseStudy.tag}
      </div>
      <h1 class="font-display font-light text-[12vw] md:text-[8rem] lg:text-[9rem] leading-[0.85] tracking-tighter text-charcoal mb-16 select-none relative uppercase">
        {caseStudy.title}<br /><span class="text-stroke">{caseStudy.subtitle}</span>
        <span class="absolute -right-4 -top-4 md:right-20 md:top-4 text-xs md:text-sm font-mono text-bronze tracking-normal opacity-80 rotate-12 border border-[color-mix(in_srgb,var(--color-bronze)_30%,transparent)] bg-badge px-2 py-1 rounded-full backdrop-blur-sm shadow-sm">{caseStudy.version}</span>
      </h1>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-y-8 gap-x-4 border-y border-[color-mix(in_srgb,var(--color-bronze)_20%,transparent)] py-8 font-mono text-xs">
        <div class="border-r border-[color-mix(in_srgb,var(--color-bronze)_20%,transparent)] pr-4 last:border-none">
          <span class="text-disabled block mb-2 text-[10px] tracking-widest">{caseStudy.roleLabel}</span>
          {caseStudy.role}
        </div>
        <div class="border-r border-[color-mix(in_srgb,var(--color-bronze)_20%,transparent)] pr-4 last:border-none">
          <span class="text-disabled block mb-2 text-[10px] tracking-widest">{caseStudy.timelineLabel}</span>
          {caseStudy.timeline}
        </div>
        <div class="col-span-2 md:col-span-2 pl-0 md:pl-4">
          <span class="text-disabled block mb-2 text-[10px] tracking-widest uppercase">{caseStudy.deliverablesLabel}</span>
          {caseStudy.deliverables}
        </div>
      </div>
    </section>
    <section class="mb-24 scroll-mt-32" id="challenge">
      <div class="technical-card p-8 md:p-14 group transition-all duration-500 hover:shadow-[0_15px_40px_rgba(168,93,61,0.08)]">
        <div class="flex flex-col md:flex-row justify-between items-start gap-8">
          <div class="md:w-1/3">
            <div class="font-mono text-bronze text-xs mb-4 flex items-center gap-2">
              <span class="material-symbols-outlined text-lg">crisis_alert</span>
              {caseStudy.challengeLabel}
            </div>
            <div class="h-[1px] w-12 bg-bronze mb-8"></div>
          </div>
          <div class="md:w-2/3">
            <h2 class="text-3xl md:text-4xl font-light mb-6 leading-tight text-charcoal">{caseStudy.challengeTitle}</h2>
            <p class="text-secondary leading-relaxed text-lg font-light">
              {caseStudy.challengeBody}
            </p>
            <div class="mt-10 grid grid-cols-2 gap-4">
              {caseStudy.challengeMetrics.map((metric) => (
                <div class="bg-surface border border-[color-mix(in_srgb,var(--color-bronze)_10%,transparent)] p-4 backdrop-blur-md">
                  <div class="text-bronze font-display text-3xl md:text-4xl mb-1 glowing-text">{metric.value}</div>
                  <div class="font-mono text-[10px] text-muted uppercase">{metric.label}</div>
                </div>
              ))}
            </div>
          </div>
        </div>
      </div>
    </section>
    <section class="mb-24 scroll-mt-32" id="stack">
      <div class="technical-card p-8 md:p-14 bg-surface">
        <div class="font-mono text-bronze text-xs mb-8 flex items-center justify-between">
          <span>{caseStudy.stackLabel}</span>
          <span class="text-muted">[SYSTEM_ARCHITECTURE]</span>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-12">
          <div>
            <h3 class="text-2xl font-light mb-4 text-charcoal">{caseStudy.stackTitle}</h3>
            <p class="text-sm text-secondary leading-relaxed mb-6">
              {caseStudy.stackBody}
            </p>
            <ul class="font-mono text-xs space-y-2 text-muted">
              {caseStudy.stack.map((item) => (
                <li class="flex items-center gap-2"><span class="text-bronze">&gt;&gt;&gt;</span> {item}</li>
              ))}
            </ul>
          </div>
          <div class="bg-surface p-6 rounded-sm border-l-2 border-[color-mix(in_srgb,var(--color-bronze)_40%,transparent)] relative shadow-2xl overflow-hidden group">
            <div class="absolute top-0 right-0 p-2 opacity-10 group-hover:opacity-20 transition-opacity">
              <span class="material-symbols-outlined text-4xl text-charcoal">code</span>
            </div>
            <div class="flex justify-between items-center mb-4 border-b border-[color-mix(in_srgb,var(--color-bronze)_20%,transparent)] pb-2">
              <span class="font-mono text-[10px] text-muted">{caseStudy.console.filename}</span>
              <div class="flex gap-1.5">
                <div class="w-2 h-2 rounded-full bg-red-900"></div>
                <div class="w-2 h-2 rounded-full bg-yellow-900"></div>
                <div class="w-2 h-2 rounded-full bg-green-900"></div>
              </div>
            </div>
            <pre class="font-mono text-[10px] md:text-xs text-secondary overflow-x-auto scrollbar-none"><code>{caseStudy.console.code}</code></pre>
            <div class={`mt-4 flex items-center gap-2 text-[9px] font-mono ${statusClassMap[caseStudy.console.statusState] ?? "text-terminal-success"}`}>
              <span class={`w-1.5 h-1.5 rounded-full animate-pulse ${statusDotMap[caseStudy.console.statusState] ?? "bg-status-online"}`}></span> {caseStudy.console.statusLabel}
            </div>
          </div>
        </div>
      </div>
    </section>
    <section class="mb-40 scroll-mt-32" id="outcome">
      <div class="relative pl-8 md:pl-12 border-l border-[color-mix(in_srgb,var(--color-bronze)_30%,transparent)]">
        <div class="absolute top-0 left-0 -translate-x-1/2 w-3 h-3 bg-cream-bg border border-bronze rotate-45 shadow-[0_0_5px_rgba(168,93,61,0.5)]"></div>
        <div class="absolute bottom-0 left-0 -translate-x-1/2 w-3 h-3 bg-cream-bg border border-bronze rotate-45 shadow-[0_0_5px_rgba(168,93,61,0.5)]"></div>
        <div class="font-mono text-bronze text-xs mb-6">{caseStudy.outcomeLabel}</div>
        <div class="flex flex-col md:flex-row items-end gap-12">
          <div class="flex-1">
            <h2 class="text-5xl md:text-7xl font-display font-light mb-6 text-charcoal glowing-text">
              {caseStudy.outcome.metric}
            </h2>
            <h3 class="text-xl font-medium mb-4 text-charcoal">{caseStudy.outcome.title}</h3>
            <p class="text-secondary max-w-xl mb-8 leading-relaxed">
              {caseStudy.outcome.body}
            </p>
          </div>
          <div class="w-full md:w-auto pb-2">
            <a class="cta-button group relative inline-flex items-center justify-center px-8 py-4 overflow-hidden font-mono font-medium tracking-tighter bg-ochre border border-ochre transition-all duration-300 shadow-[0_0_15px_rgba(217,119,6,0.4)]" href={caseStudy.outcome.ctaHref}>
              <span class="absolute w-0 h-0 transition-all duration-500 ease-out bg-white rounded-full group-hover:w-56 group-hover:h-56 opacity-10"></span>
              <span class="relative flex items-center gap-3">
                {caseStudy.outcome.ctaLabel}
                <span class="material-symbols-outlined text-sm group-hover:translate-x-1 transition-transform">arrow_outward</span>
              </span>
            </a>
          </div>
        </div>
      </div>
    </section>
    <Footer site={site} />
  </main>
</div>
